
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文件交接</title>
    <style>
        body {
            font-family: 'Times New Roman', Times, serif;
            padding: 15px;
            max-width: 500px;
            margin: 0 auto;
            background-color: #f9f9f9;
        }
        .container {
            border: 2px solid #FF0000;
            padding: 20px;
            border-radius: 5px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
        }
        .logo {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 20px;
            font-weight: bold;
            color: #FF0000;
        }
        h2 {
            color: #FF0000;
            font-size: 24px;
            text-align: center;
            margin: 10px 0 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        label {
            width: 60px;
            font-weight: bold;
            margin-right: 5px;
        }
        select {
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-family: 'Times New Roman', Times, serif;
            font-size: 14px;
            flex: 1;
            max-width: 150px;
        }
        .arrow {
            margin: 0 5px;
            font-size: 16px;
            font-weight: bold;
            color: #FF0000;
        }
        .time-display {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
            padding: 5px;
            background-color: #f5f5f5;
            border-radius: 3px;
        }
        button {
            padding: 8px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-family: 'Times New Roman', Times, serif;
            font-size: 16px;
            display: block;
            margin: 20px auto 0;
            width: 100px;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .file-display {
            font-weight: bold;
            margin-bottom: 15px;
            padding: 8px;
            background-color: #f5f5f5;
            border-radius: 3px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">PORITE</div>
        <h2>文件交接</h2>
        
        <div class="form-group">
            <div class="file-display" id="fileDisplay"></div>
        </div>
        
        <div class="form-row">
            <label>本人:</label>
            <select id="sender"></select>
            <span class="arrow">→</span>
            <label>接收人:</label>
            <select id="receiver"></select>
        </div>
        
        <div class="form-group">
            <div class="time-display" id="timeDisplay"></div>
        </div>
        
        <button id="submitBtn" onclick="submitForm()">提交</button>
    </div>

    <script>
        // 解析URL参数
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                file: decodeURIComponent(params.get('file') || '未指定文件'),
                personnel: (params.get('personnel') || '').split(',')
            };
        }

        // 检测企业微信环境并获取用户
        function getWeComUser() {
            // 企业微信API获取当前用户
            // 实际使用时需要接入企业微信JS-SDK
            // 这里用模拟数据演示
            if(window.navigator.userAgent.toLowerCase().indexOf('wxwork') > -1) {
                return '企业微信用户'; // 实际使用时应替换为真实获取逻辑
            }
            return null;
        }

        // 初始化页面
        function init() {
            const params = getUrlParams();
            const currentFile = params.file;
            document.getElementById('fileDisplay').textContent = "文件: " + currentFile;
            
            // 显示当前时间
            updateTimeDisplay();
            setInterval(updateTimeDisplay, 1000);
            
            // 获取企业微信用户(如果是在企业微信中打开)
            const weComUser = getWeComUser();
            
            // 填充人员下拉框
            const personnel = params.personnel.filter(p => p.trim() !== '');
            const senderSelect = document.getElementById('sender');
            const receiverSelect = document.getElementById('receiver');
            
            // 添加人员选项
            personnel.forEach(person => {
                const option = document.createElement('option');
                option.value = person;
                option.textContent = person;
                senderSelect.appendChild(option.cloneNode(true));
                receiverSelect.appendChild(option.cloneNode(true));
            });
            
            // 设置默认发送人(企业微信用户优先)
            if(weComUser) {
                const option = document.createElement('option');
                option.value = weComUser;
                option.textContent = weComUser;
                senderSelect.insertBefore(option, senderSelect.firstChild);
                senderSelect.value = weComUser;
            }
            
            // 检查是否已提交
            if(sessionStorage.getItem('submitted_' + encodeURIComponent(currentFile))) {
                disableForm();
            }
        }

        // 更新时间显示
        function updateTimeDisplay() {
            const now = new Date();
            const timeString = now.getFullYear() + '-' + 
                             String(now.getMonth() + 1).padStart(2, '0') + '-' + 
                             String(now.getDate()).padStart(2, '0') + ' ' + 
                             String(now.getHours()).padStart(2, '0') + ':' + 
                             String(now.getMinutes()).padStart(2, '0') + ':' + 
                             String(now.getSeconds()).padStart(2, '0');
            
            document.getElementById('timeDisplay').textContent = "时间: " + timeString;
            return timeString;
        }

        // 禁用表单(已提交状态)
        function disableForm() {
            document.getElementById('sender').disabled = true;
            document.getElementById('receiver').disabled = true;
            const btn = document.getElementById('submitBtn');
            btn.disabled = true;
            btn.textContent = '已提交';
            btn.style.backgroundColor = '#cccccc';
        }

        // 提交表单
        function submitForm() {
            const sender = document.getElementById('sender').value;
            const receiver = document.getElementById('receiver').value;
            const file = getUrlParams().file;
            const time = updateTimeDisplay();
            
            if(!sender || !receiver) {
                alert('请选择本人和接收人');
                return;
            }
            
            if(sender === receiver) {
                alert('本人和接收人不能相同');
                return;
            }
            
            // 构造邮件内容(确保正确换行)
            const subject = `【文件交接】${file}_${sender} → ${receiver}`;
            const body = `文件: ${file}\n时间: ${time}\n交接: ${sender} → ${receiver}`;
            
            // 发送邮件
            window.location.href = `mailto:lium@porite.com.cn?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            
            // 标记为已提交(使用sessionStorage，只在当前会话有效)
            sessionStorage.setItem('submitted_' + encodeURIComponent(file), 'true');
            disableForm();
            
            alert('即将打开邮件客户端，请确认发送');
        }

        // 页面加载时初始化
        window.onload = init;
    </script>
</body>
</html>
