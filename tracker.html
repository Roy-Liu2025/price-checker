<script>
async function submitRecord() {
    const btn = document.querySelector("button");
    const statusEl = document.getElementById("status");
    btn.disabled = true;
    statusEl.innerHTML = '<p style="color:#666">提交中...</p>';

    // 调试：打印当前文件标识和 Token（检查拼写）
    console.log("FileID:", fileId);
    console.log("Token:", 'ghp_你的Token');

    try {
        const response = await fetch(
            `https://api.github.com/repos/roy-liu2025/price-checker/contents/logs/${encodeURIComponent(fileId)}.json`,
            {
                method: 'PUT',
                headers: {
                    'Authorization': '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', // 确保替换为最新 Token
                    'Content-Type': 'application/json',
                    'Accept': 'application/vnd.github.v3+json'
                },
                body: JSON.stringify({
                    message: `[记录] ${fileId}`,
                    content: btoa(unescape(encodeURIComponent(JSON.stringify({
                        file: fileId,
                        time: new Date().toLocaleString()
                    })))
                })
            }
        );

        // 调试：打印 API 响应
        const data = await response.json();
        console.log("API 响应:", data);

        if (response.ok) {
            statusEl.innerHTML = '<p style="color:#238636">✔ 记录已安全存储</p>';
        } else {
            throw new Error(data.message || "未知错误");
        }
    } catch (error) {
        statusEl.innerHTML = `<p style="color:#da3633">✖ 提交失败: ${error.message}</p>`;
        btn.disabled = false;
    }
}
</script>
