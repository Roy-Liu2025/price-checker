<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文件交接确认</title>
    <style>
        body {
            font-family: "Times New Roman", sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 25px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
        }
        .file-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 16px;
        }
        .file-table th, .file-table td {
            border: 1px solid #ddd;
            padding: 10px 8px;
            text-align: left;
        }
        .file-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        /* 调整列宽 */
        .file-table th:nth-child(1),
        .file-table td:nth-child(1) {
            width: 40%; /* 文件列宽度减少 */
        }
        .file-table th:nth-child(2),
        .file-table td:nth-child(2) {
            width: 30%; /* 人员列宽度增加 */
        }
        .file-table th:nth-child(3),
        .file-table td:nth-child(3) {
            width: 30%; /* 时间列宽度不变 */
            padding: 10px 5px; /* 两端留白减少 */
        }
        input {
            padding: 12px;
            width: 90%;
            margin: 15px 0;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        button {
            padding: 12px 30px;
            background: #4CAF50; /* 初始绿色 */
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            margin-top: 20px;
            display: block;
            margin-left: auto;
            margin-right: auto;
            cursor: pointer;
            transition: all 0.3s;
        }
        button:disabled {
            background: #cccccc; /* 禁用后灰色 */
            cursor: not-allowed;
        }
        .porite-logo {
            position: absolute;
            bottom: 15px;
            right: 20px;
            font-family: "Times New Roman", sans-serif;
            font-size: 24px;
            color: red;
            font-weight: bold;
        }
        #resultMsg {
            min-height: 50px;
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2 style="text-align:center;">文件接收确认</h2>
        
        <table class="file-table">
            <thead>
                <tr>
                    <th>文件名称</th>
                    <th>接受人员</th>
                    <th>接受时间</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td id="filename-cell">加载中...</td>
                    <td id="receiver-cell">????</td>
                    <td id="time-cell">2025/8/9 11:38</td>
                </tr>
            </tbody>
        </table>
        
        <input type="text" id="userInput" placeholder="请输入您的姓名" required>
        
        <button id="submitBtn">确认接收</button>
        <p id="resultMsg"></p>
        
        <div class="porite-logo">porite</div>
    </div>

    <script>
        // 从URL获取文件标识
        const urlParams = new URLSearchParams(window.location.search);
        const fileId = urlParams.get('file') || '未指定文件';
        document.getElementById("filename-cell").textContent = fileId;

        // 邮件内容生成函数（含右下角porite）
        function getEmailContent(fileId, userName, time) {
            // 计算字符串显示宽度（中文算2个字符）
            const getDisplayWidth = (str) => {
                return str.split('').reduce((total, char) => {
                    return total + (char.match(/[^\x00-\xff]/) ? 2 : 1);
                }, 0);
            };

            // 生成固定宽度行
            const formatLine = (name, value) => {
                const nameWidth = 15;  // NAME列基础宽度
                const valueWidth = 40; // VALUE列宽度（原20的2倍）
                
                // 对齐处理（考虑中文字符）
                let namePadding = nameWidth - getDisplayWidth(name);
                let valuePadding = valueWidth - getDisplayWidth(value);
                
                return name + ' '.repeat(Math.max(0, namePadding)) + 
                       value + ' '.repeat(Math.max(0, valuePadding));
            };

            // 分隔线（长度与表格匹配）
            const separator = '─'.repeat(55);
            
            return `
文件接收确认详情：
${separator}
${formatLine('NAME', 'VALUE')}
${separator}
${formatLine('文件名称', fileId)}
${formatLine('接受人员', userName)}
${formatLine('接受时间', time)}
${separator}

                                                            porite
            `.trim();
        }

        // 提交处理
        document.getElementById("submitBtn").addEventListener('click', async () => {
            const btn = document.getElementById("submitBtn");
            const userName = document.getElementById("userInput").value.trim();
            
            if (!userName) {
                alert("请输入您的姓名");
                return;
            }
            
            btn.disabled = true;
            btn.textContent = "已确认";
            
            const timestamp = new Date().toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });

            // 更新表格中的接受人员和时间
            document.getElementById("receiver-cell").textContent = userName;
            document.getElementById("time-cell").textContent = timestamp;

            try {
                const response = await fetch("https://formsubmit.co/ajax/lium@porite.com.cn", {
                    method: "POST",
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        _template: "basic",
                        _subject: `文件接收确认 - ${fileId}_${userName}`,
                        _replyto: "lium@porite.com.cn",
                        _cc: "lium@porite.com.cn",
                        message: getEmailContent(fileId, userName, timestamp)
                    })
                });
                
                const result = await response.json();
                
                document.getElementById("resultMsg").innerHTML = response.ok ? 
                    '<span style="color:green;font-weight:bold;">✅ 接收确认已发送</span>' : 
                    '<span style="color:red;font-weight:bold;">❌ 提交失败，请截图联系管理员</span>';
            } catch (error) {
                document.getElementById("resultMsg").innerHTML = 
                    '<span style="color:red;font-weight:bold;">❌ 网络错误，请检查连接</span>';
                // 出错时恢复按钮状态
                btn.disabled = false;
                btn.textContent = "确认接收";
            }
        });

        // 测试输出（开发时验证格式）
        console.log(getEmailContent(
            "250808_22888809-1_量产资料", 
            "张三", 
            "2025/08/09 10:05:23"
        ));
    </script>
</body>
</html>


